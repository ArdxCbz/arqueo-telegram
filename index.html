<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arqueo y Cobros de Cr√©ditos</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
    <div class="container">
        <!-- Navigation Tabs -->
        <nav class="tabs-nav">
            <button class="tab-btn active" data-tab="arqueo">
                <span class="tab-icon">üí∞</span>
                <span class="tab-text">Arqueo</span>
            </button>
            <button class="tab-btn" data-tab="visitas">
                <span class="tab-icon">üìç</span>
                <span class="tab-text">Visitas</span>
            </button>
            <button class="tab-btn" data-tab="ruta">
                <span class="tab-icon">üìÇ</span>
                <span class="tab-text">Ruta</span>
            </button>
        </nav>

        <!-- ==================== TAB: ARQUEO ==================== -->
        <div class="tab-content active" id="tab-arqueo">
            <!-- Header -->
            <header class="header">
                <h1>ARQUEO Y COBROS DE CR√âDITOS</h1>
                <div class="vendedor-info">
                    <span class="label">Vendedor:</span>
                    <span id="vendedor-nombre" class="value">Cargando...</span>
                </div>
                <div class="fecha-info">
                    <div class="fecha-group">
                        <input type="date" id="fecha" class="fecha-input">
                        <span id="dia-semana" class="dia-badge">---</span>
                    </div>
                </div>
            </header>

            <!-- Secci√≥n: Ventas -->
            <section class="section ventas-section">
                <h2 class="section-title">
                    <span class="icon">üí∞</span> Ventas
                </h2>
                <div class="form-group">
                    <label for="venta-bruta">Venta Bruta</label>
                    <div class="input-money">
                        <input type="text" id="venta-bruta" inputmode="decimal" placeholder="0,00">
                        <span class="currency">Bs</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="descuentos">Descuentos</label>
                    <div class="input-money">
                        <input type="text" id="descuentos" inputmode="decimal" placeholder="0,00">
                        <span class="currency">Bs</span>
                    </div>
                </div>
                <div class="form-group resultado">
                    <label>Venta Total</label>
                    <div class="input-money readonly">
                        <span id="venta-total" class="calculated-value">0,00</span>
                        <span class="currency">Bs</span>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: Registro de Cr√©ditos -->
            <section class="section creditos-section">
                <h2 class="section-title">
                    <span class="icon">üìã</span> Registro de Cr√©ditos
                </h2>
                <div class="creditos-table-container">
                    <table class="creditos-table" id="creditos-table">
                        <thead>
                            <tr>
                                <th>C√≥digo Cliente</th>
                                <th>Saldo</th>
                                <th>Cobrado</th>
                                <th>Venta Cr√©d.</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="creditos-body">
                            <!-- Filas din√°micas -->
                        </tbody>
                        <tfoot>
                            <tr class="totales-row">
                                <td><strong>TOTALES</strong></td>
                                <td id="total-saldo">0,00</td>
                                <td id="total-cobrado">0,00</td>
                                <td id="total-venta-credito">0,00</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <button type="button" class="btn-add" id="btn-add-credito">
                    <span>+</span> Agregar Cliente
                </button>
            </section>

            <!-- Secci√≥n: Gastos -->
            <section class="section gastos-section">
                <h2 class="section-title">
                    <span class="icon">üßæ</span> Gastos
                </h2>
                <div id="gastos-container">
                    <div class="gasto-row" data-gasto="combustible">
                        <label>Combustible</label>
                        <div class="input-money">
                            <input type="text" class="gasto-input" inputmode="decimal" placeholder="0,00">
                            <span class="currency">Bs</span>
                        </div>
                    </div>
                    <div class="gasto-row" data-gasto="peaje">
                        <label>Peaje</label>
                        <div class="input-money">
                            <input type="text" class="gasto-input" inputmode="decimal" placeholder="0,00">
                            <span class="currency">Bs</span>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" id="btn-add-gasto">
                    <span>+</span> Agregar Gasto
                </button>
                <div class="form-group resultado total-gastos">
                    <label>Total Gastos</label>
                    <div class="input-money readonly">
                        <span id="total-gastos" class="calculated-value">0,00</span>
                        <span class="currency">Bs</span>
                    </div>
                </div>
            </section>

            <!-- Secci√≥n: Totales -->
            <section class="section totales-section">
                <h2 class="section-title">
                    <span class="icon">üìä</span> Total a Entregar
                </h2>
                <div class="total-efectivo-box">
                    <span class="total-label">TOTAL EFECTIVO</span>
                    <span id="total-efectivo" class="total-value">0,00 Bs</span>
                </div>
                <p class="total-formula">= Venta Total + Cr√©ditos Cobrados - Ventas a Cr√©dito - Gastos</p>
            </section>

            <!-- Secci√≥n: Dinero Entregado -->
            <section class="section entrega-section">
                <h2 class="section-title">
                    <span class="icon">üíµ</span> Dinero Entregado
                </h2>
                <div class="form-group">
                    <label for="efectivo-entregado">Efectivo</label>
                    <div class="input-money">
                        <input type="text" id="efectivo-entregado" inputmode="decimal" placeholder="0,00">
                        <span class="currency">Bs</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="qr-entregado">QR / Transferencia</label>
                    <div class="input-money">
                        <input type="text" id="qr-entregado" inputmode="decimal" placeholder="0,00">
                        <span class="currency">Bs</span>
                    </div>
                </div>
                <div class="diferencia-box" id="diferencia-box">
                    <span class="diferencia-label">DIFERENCIA</span>
                    <span id="diferencia" class="diferencia-value">0,00 Bs</span>
                </div>
            </section>

            <!-- Bot√≥n Enviar Arqueo -->
            <div class="submit-container">
                <button type="button" class="btn-submit" id="btn-enviar">
                    Enviar Arqueo
                </button>
            </div>
        </div>

        <!-- ==================== TAB: VISITAS ==================== -->
        <div class="tab-content" id="tab-visitas">
            <header class="header">
                <h1>CONTROL DE VISITAS</h1>
                <div class="vendedor-info">
                    <span class="label">Vendedor:</span>
                    <span id="vendedor-nombre-visitas" class="value">Cargando...</span>
                </div>
            </header>

            <!-- Selector de D√≠a -->
            <section class="section dia-selector-section">
                <div class="dia-selector">
                    <button type="button" class="dia-nav-btn" id="btn-dia-prev">‚óÑ</button>
                    <div class="dia-display">
                        <span id="dia-nombre" class="dia-nombre">VIERNES</span>
                        <span id="dia-fecha" class="dia-fecha">17/1/26</span>
                    </div>
                    <button type="button" class="dia-nav-btn" id="btn-dia-next">‚ñ∫</button>
                </div>
            </section>

            <!-- Lista de Clientes -->
            <section class="section clientes-section">
                <h2 class="section-title">
                    <span class="icon">üë•</span> Clientes del D√≠a
                </h2>
                <div id="clientes-list" class="clientes-list">
                    <!-- Lista din√°mica de clientes -->
                    <div class="cliente-row">
                        <label class="cliente-checkbox">
                            <input type="checkbox" class="visita-check">
                            <span class="checkmark"></span>
                        </label>
                        <div class="cliente-info">
                            <span class="cliente-codigo">C001</span>
                            <span class="cliente-nombre">Tienda La Esquina</span>
                        </div>
                    </div>
                </div>

                <div class="visitas-empty" id="visitas-empty" style="display: none;">
                    <span class="empty-icon">üì≠</span>
                    <p>No hay clientes programados para este d√≠a</p>
                </div>
            </section>

            <!-- Resumen de Visitas -->
            <section class="section resumen-visitas">
                <div class="visitas-counter">
                    <span class="counter-label">Visitados:</span>
                    <span id="visitas-count" class="counter-value">0</span>
                    <span class="counter-separator">/</span>
                    <span id="visitas-total" class="counter-total">0</span>
                </div>
                <div class="visitas-progress">
                    <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                </div>
            </section>

            <!-- Bot√≥n Guardar Visitas -->
            <div class="submit-container">
                <button type="button" class="btn-submit btn-visitas" id="btn-guardar-visitas">
                    Guardar Visitas
                </button>
            </div>
        </div>

        <!-- ==================== TAB: RUTA ==================== -->
        <div class="tab-content" id="tab-ruta">
            <!-- Header -->
            <header class="header">
                <h1>CONFIGURAR MI RUTA</h1>
                <div class="vendedor-info">
                    <span class="label">Vendedor:</span>
                    <span id="vendedor-nombre-ruta" class="value">Cargando...</span>
                </div>
            </header>

            <!-- Instrucciones -->
            <section class="section">
                <h2 class="section-title">
                    <span class="icon">üìã</span> Instrucciones
                </h2>
                <div class="instrucciones-box">
                    <p>Sube tu archivo <strong>CSV</strong> exportado de la app de mapas.</p>
                    <p>El archivo debe tener:</p>
                    <ul>
                        <li><strong>Columna 1:</strong> D√≠a (Lunes, Martes, etc.)</li>
                        <li><strong>Columna 5:</strong> C√≥digo + Nombre del cliente</li>
                    </ul>
                </div>
            </section>

            <!-- Upload Zone -->
            <section class="section upload-section">
                <h2 class="section-title">
                    <span class="icon">üìÇ</span> Subir Archivo
                </h2>
                <div class="upload-zone" id="upload-zone">
                    <input type="file" id="csv-input" accept=".csv" hidden>
                    <div class="upload-content">
                        <span class="upload-icon">üìÑ</span>
                        <p class="upload-text">Haz clic o arrastra tu archivo CSV aqu√≠</p>
                        <button type="button" class="btn-select-file" id="btn-select-file">Seleccionar Archivo</button>
                    </div>
                </div>
                <div class="file-info" id="file-info" style="display: none;">
                    <span class="file-name" id="file-name"></span>
                    <button type="button" class="btn-remove-file" id="btn-remove-file">‚úï</button>
                </div>
            </section>

            <!-- Preview -->
            <section class="section preview-section" id="preview-section" style="display: none;">
                <h2 class="section-title">
                    <span class="icon">üëÅÔ∏è</span> Vista Previa
                </h2>
                <div class="preview-stats">
                    <div class="stat-item">
                        <span class="stat-value" id="preview-total">0</span>
                        <span class="stat-label">Clientes</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="preview-dias">0</span>
                        <span class="stat-label">D√≠as</span>
                    </div>
                </div>
                <div class="preview-table-container">
                    <table class="preview-table" id="preview-table">
                        <thead>
                            <tr>
                                <th>D√≠a</th>
                                <th>C√≥digo</th>
                                <th>Nombre</th>
                            </tr>
                        </thead>
                        <tbody id="preview-tbody">
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Bot√≥n Guardar -->
            <div class="submit-container" id="submit-ruta-container" style="display: none;">
                <button type="button" class="btn-submit btn-ruta" id="btn-guardar-ruta">
                    üîÑ Actualizar Mi Ruta
                </button>
            </div>

            <!-- Resultado -->
            <div class="result-message" id="result-message" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
    <script src="app.js"></script>
</body>

</html>